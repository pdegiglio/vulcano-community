// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  password      String
  firstName     String
  lastName      String
  apartmentNumber String  @unique
  tower         Tower
  moveInDate    DateTime?
  phoneNumber   String?
  role          UserRole  @default(RESIDENT)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relations
  posts         Post[]
  comments      Comment[]
  maintenanceRequests MaintenanceRequest[]
  eventRSVPs    EventRSVP[]
  
  @@map("users")
}

model Post {
  id          String      @id @default(cuid())
  title       String
  content     String
  category    PostCategory
  isAnnouncement Boolean  @default(false)
  isEmergency Boolean     @default(false)
  authorId    String
  author      User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  
  // Relations
  comments    Comment[]
  
  @@map("posts")
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  postId    String
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  authorId  String
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("comments")
}

model MaintenanceRequest {
  id          String              @id @default(cuid())
  title       String
  description String
  category    MaintenanceCategory
  priority    Priority            @default(MEDIUM)
  status      RequestStatus       @default(SUBMITTED)
  apartmentNumber String
  requesterId String
  requester   User               @relation(fields: [requesterId], references: [id], onDelete: Cascade)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  completedAt DateTime?
  
  @@map("maintenance_requests")
}

model Event {
  id          String    @id @default(cuid())
  title       String
  description String
  location    String
  startTime   DateTime
  endTime     DateTime
  maxAttendees Int?
  isPublic    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  rsvps       EventRSVP[]
  
  @@map("events")
}

model EventRSVP {
  id        String     @id @default(cuid())
  eventId   String
  event     Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  status    RSVPStatus @default(PENDING)
  createdAt DateTime   @default(now())
  
  @@unique([eventId, userId])
  @@map("event_rsvps")
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  content   String
  priority  Priority @default(MEDIUM)
  isActive  Boolean  @default(true)
  expiresAt DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("announcements")
}

// Enums
enum Tower {
  A
  B
  C
}

enum UserRole {
  RESIDENT
  ADMIN
  CONCIERGE
  MAINTENANCE
}

enum PostCategory {
  GENERAL
  EVENTS
  LOST_FOUND
  FOR_SALE
  MAINTENANCE
  SAFETY
  AMENITIES
}

enum MaintenanceCategory {
  PLUMBING
  ELECTRICAL
  HVAC
  APPLIANCES
  COMMON_AREAS
  ELEVATORS
  SECURITY
  OTHER
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum RequestStatus {
  SUBMITTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum RSVPStatus {
  PENDING
  ATTENDING
  NOT_ATTENDING
}
